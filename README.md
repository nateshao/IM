# é«˜æ€§èƒ½IMç³»ç»Ÿ

ä¸€ä¸ªé«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„å³æ—¶é€šè®¯ç³»ç»Ÿï¼Œæ”¯æŒç¦»çº¿æ¶ˆæ¯å’Œç¾¤èŠåŠŸèƒ½ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Client    â”‚    â”‚  Mobile Client  â”‚    â”‚   API Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Load Balancer         â”‚
                    â”‚    (Nginx/Traefik)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   WebSocket Gateway       â”‚
                    â”‚   (Gorilla WebSocket)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Message Service       â”‚
                    â”‚   (Goroutine + Channel)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                      â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis Cluster   â”‚  â”‚   Kafka Cluster   â”‚  â”‚   MySQL Cluster   â”‚
â”‚  (Pub/Sub + Cache)â”‚  â”‚  (Message Queue)  â”‚  â”‚  (Message Store)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|----------|------|
| é•¿è¿æ¥ | Gorilla WebSocket | é«˜æ€§èƒ½WebSocketåº“ |
| åç¨‹é€šä¿¡ | Channel + Goroutine | GoåŸç”Ÿå¹¶å‘æ¨¡å‹ |
| çŠ¶æ€å­˜å‚¨ | Redis | ç”¨æˆ·çŠ¶æ€ã€ä¼šè¯ç¼“å­˜ |
| æ¶ˆæ¯é˜Ÿåˆ— | Kafka | æ¶ˆæ¯æŒä¹…åŒ–å’Œå¼‚æ­¥æŠ•é€’ |
| æ•°æ®åº“ | MySQL | æ¶ˆæ¯æŒä¹…åŒ–å­˜å‚¨ |
| IDç”Ÿæˆå™¨ | Snowflake | åˆ†å¸ƒå¼IDç”Ÿæˆ |
| æ—¥å¿—ç³»ç»Ÿ | Zap | é«˜æ€§èƒ½æ—¥å¿—åº“ |
| ç›‘æ§ | Prometheus + Grafana | ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦ |

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- âœ… é«˜å¹¶å‘WebSocketè¿æ¥ç®¡ç†
- âœ… å®æ—¶æ¶ˆæ¯æ¨é€
- âœ… ç¦»çº¿æ¶ˆæ¯å­˜å‚¨å’ŒåŒæ­¥
- âœ… ç¾¤èŠåŠŸèƒ½
- âœ… å¿ƒè·³æ£€æµ‹å’Œç”¨æˆ·çŠ¶æ€ç®¡ç†
- âœ… æ¶ˆæ¯æŒä¹…åŒ–å’Œå¯é æ€§ä¿è¯
- âœ… åˆ†å¸ƒå¼éƒ¨ç½²æ”¯æŒ
- âœ… å®Œæ•´çš„ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

## ğŸ“ é¡¹ç›®ç»“æ„

```
IM/
â”œâ”€â”€ cmd/                    # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ server/            # WebSocketæœåŠ¡å™¨
â”‚   â””â”€â”€ client/            # æµ‹è¯•å®¢æˆ·ç«¯
â”œâ”€â”€ internal/              # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ handler/          # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”œâ”€â”€ model/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ service/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ store/            # æ•°æ®å­˜å‚¨å±‚
â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”œâ”€â”€ pkg/                   # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ websocket/        # WebSocketå°è£…
â”‚   â”œâ”€â”€ snowflake/        # IDç”Ÿæˆå™¨
â”‚   â””â”€â”€ logger/           # æ—¥å¿—å·¥å…·
â”œâ”€â”€ deployments/           # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ docker/           # Dockeré…ç½®
â”‚   â””â”€â”€ k8s/              # Kubernetesé…ç½®
â”œâ”€â”€ scripts/              # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ test/             # æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ benchmark/        # æ€§èƒ½æµ‹è¯•
â””â”€â”€ docs/                 # æ–‡æ¡£
    â”œâ”€â”€ api/              # APIæ–‡æ¡£
    â””â”€â”€ design/           # è®¾è®¡æ–‡æ¡£
```

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21+
- Docker & Docker Compose
- Redis 7.0+
- Kafka 3.0+
- MySQL 8.0+

### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose up -d

# å¯åŠ¨IMæœåŠ¡å™¨
go run cmd/server/main.go

# è¿è¡Œæµ‹è¯•å®¢æˆ·ç«¯
go run cmd/client/main.go
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- æ”¯æŒ10ä¸‡+å¹¶å‘è¿æ¥
- æ¶ˆæ¯å»¶è¿Ÿ < 10ms
- æ¶ˆæ¯ååé‡ > 100K/s
- 99.9%å¯ç”¨æ€§

## ğŸ“ åè®®è®¾è®¡

### WebSocketæ¶ˆæ¯æ ¼å¼

```json
{
  "type": "message_type",
  "data": {},
  "timestamp": 1640995200000,
  "message_id": "snowflake_id"
}
```

### æ”¯æŒçš„æ¶ˆæ¯ç±»å‹

- `login`: ç”¨æˆ·ç™»å½•
- `heartbeat`: å¿ƒè·³åŒ…
- `send_message`: å‘é€æ¶ˆæ¯
- `ack`: æ¶ˆæ¯ç¡®è®¤
- `sync_offline`: åŒæ­¥ç¦»çº¿æ¶ˆæ¯
- `join_group`: åŠ å…¥ç¾¤èŠ
- `leave_group`: ç¦»å¼€ç¾¤èŠ

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

- PrometheusæŒ‡æ ‡æ”¶é›†
- Grafanaä»ªè¡¨æ¿
- ELKæ—¥å¿—åˆ†æ
- å®æ—¶å‘Šè­¦ç³»ç»Ÿ

## ï¿½ï¿½ è®¸å¯è¯

MIT License 